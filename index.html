<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Poker Odds Calculator</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: white;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    #results {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    .section {
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .card-slot {
      display: inline-block;
      margin: 0.2rem;
      padding: 0.5rem;
      min-width: 55px;
      height: 70px;
      border: 2px solid #555;
      border-radius: 6px;
      background: #222;
      font-size: 1.3rem;
      color: white;
      vertical-align: middle;
    }
    .card-slot.filled {
      background: #666;
      border-color: white;
    }
    .card-grid {
      display: grid;
      grid-template-columns: repeat(13, 1fr);
      gap: 0.4rem;
      max-width: 900px;
      margin: auto;
    }
    .card {
      background: #333;
      border: 2px solid white;
      padding: 0.6rem;
      text-align: center;
      font-size: 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .card.selected {
      background: olive;
    }
    .hearts, .diamonds { color: #ff4d4d; }
    .clubs, .spades { color: #4df0ff; }

    .counter-controls {
      margin-top: 0.5rem;
    }
    .counter-btn {
      padding: 0.4rem 0.8rem;
      margin: 0 0.3rem;
      font-size: 1rem;
      background: #444;
      color: white;
      border: 2px solid white;
      border-radius: 5px;
      cursor: pointer;
    }
    .counter-btn:hover {
      background: olive;
    }

    .reset-btn {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: crimson;
      border: 2px solid white;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    .reset-btn:hover {
      background: darkred;
    }
  </style>
</head>
<body>

<h1>Poker Odds Calculator</h1>

<div id="results">
  <span id="oddsText">Waiting for input...</span><br><br>
  Players: <span id="playerCountDisplay">8</span>
  <div class="counter-controls">
    <button class="counter-btn" onclick="changePlayerCount(1)">▲</button>
    <button class="counter-btn" onclick="changePlayerCount(-1)">▼</button>
  </div>
  <button class="reset-btn" onclick="resetAll()">Reset</button>
</div>

<div class="section">
  <h3>Your Cards</h3>
  <div id="yourCards">
    <div class="card-slot" id="your1"></div>
    <div class="card-slot" id="your2"></div>
  </div>
</div>

<div class="section">
  <h3>Community Cards</h3>
  <div id="communityCards">
    <div class="card-slot" id="comm1"></div>
    <div class="card-slot" id="comm2"></div>
    <div class="card-slot" id="comm3"></div>
    <div class="card-slot" id="comm4"></div>
    <div class="card-slot" id="comm5"></div>
  </div>
</div>

<div class="card-grid" id="cardGrid"></div>

<script>
const suits = ["♠", "♥", "♦", "♣"];
const suitClass = ["spades", "hearts", "diamonds", "clubs"];
const ranks = ["2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A"];
let selectedCards = [];
let playerCount = 8;

const cardGrid = document.getElementById("cardGrid");
const oddsText = document.getElementById("oddsText");
const playerCountDisplay = document.getElementById("playerCountDisplay");

function renderDeck() {
  cardGrid.innerHTML = "";
  suits.forEach((suit, s) => {
    ranks.forEach(rank => {
      const card = rank + suit;
      const div = document.createElement("div");
      div.className = `card ${suitClass[s]}`;
      div.textContent = rank + suit;
      div.dataset.card = rank + ["s", "h", "d", "c"][s];
      div.onclick = () => toggleCard(div.dataset.card, div);
      if (selectedCards.includes(div.dataset.card)) {
        div.classList.add("selected");
      }
      cardGrid.appendChild(div);
    });
  });
}

function toggleCard(card, element) {
  if (selectedCards.includes(card)) {
    selectedCards = selectedCards.filter(c => c !== card);
  } else if (selectedCards.length < 7) {
    selectedCards.push(card);
  }
  updateVisuals();
  calculateOdds();
}

function updateVisuals() {
  renderDeck();
  const your1 = document.getElementById("your1");
  const your2 = document.getElementById("your2");
  const comm = [
    document.getElementById("comm1"),
    document.getElementById("comm2"),
    document.getElementById("comm3"),
    document.getElementById("comm4"),
    document.getElementById("comm5"),
  ];

  [your1, your2].forEach((el, i) => {
    if (selectedCards[i]) {
      el.textContent = formatCard(selectedCards[i]);
      el.classList.add("filled");
    } else {
      el.textContent = "";
      el.classList.remove("filled");
    }
  });

  comm.forEach((el, i) => {
    if (selectedCards[i + 2]) {
      el.textContent = formatCard(selectedCards[i + 2]);
      el.classList.add("filled");
    } else {
      el.textContent = "";
      el.classList.remove("filled");
    }
  });
}

function formatCard(c) {
  const rank = c.slice(0, -1);
  const suit = { s: "♠", h: "♥", d: "♦", c: "♣" }[c.slice(-1)];
  return rank + suit;
}

function changePlayerCount(delta) {
  playerCount = Math.min(8, Math.max(1, playerCount + delta));
  playerCountDisplay.textContent = playerCount;
  calculateOdds();
}

function resetAll() {
  selectedCards = [];
  oddsText.textContent = "Waiting for input...";
  updateVisuals();
}

function getDeck() {
  const fullDeck = [];
  for (let s of ["s", "h", "d", "c"]) {
    for (let r of ranks) {
      fullDeck.push(r + s);
    }
  }
  return fullDeck.filter(c => !selectedCards.includes(c));
}

function evaluate(cards) {
  const values = { "2":2, "3":3, "4":4, "5":5, "6":6, "7":7, "8":8,
    "9":9, "10":10, "J":11, "Q":12, "K":13, "A":14 };
  return cards.map(c => values[c.slice(0, -1)]).reduce((a,b)=>a+b, 0);
}

function calculateOdds() {
  if (selectedCards.length < 2) {
    oddsText.textContent = "Select at least 2 cards.";
    return;
  }
  if (![2, 5, 6, 7].includes(selectedCards.length)) {
    oddsText.textContent = "Select 2, 5, 6, or 7 cards total.";
    return;
  }

  let wins = 0, ties = 0, total = 0;
  const sims = 1000;

  for (let i = 0; i < sims; i++) {
    const deck = getDeck().slice();
    shuffle(deck);

    const playerHand = selectedCards.slice(0,2);
    const community = selectedCards.slice(2);
    while (community.length < 5) community.push(deck.pop());

    const playerScore = evaluate(playerHand.concat(community));
    const oppScores = [];
    for (let j = 0; j < playerCount; j++) {
      const opp = [deck.pop(), deck.pop()];
      const score = evaluate(opp.concat(community));
      oppScores.push(score);
    }

    const bestOpp = Math.max(...oppScores);
    if (playerScore > bestOpp) wins++;
    else if (playerScore === bestOpp) ties++;
    total++;
  }

  const winPct = (wins / total * 100).toFixed(1);
  const tiePct = (ties / total * 100).toFixed(1);
  const lossPct = (100 - winPct - tiePct).toFixed(1);

  oddsText.textContent = `Win: ${winPct}% | Tie: ${tiePct}% | Loss: ${lossPct}%`;
}

function shuffle(arr) {
  for (let i = arr.length-1; i > 0; i--) {
    const j = Math.floor(Math.random()* (i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

renderDeck();
updateVisuals();
</script>

</body>
</html>
